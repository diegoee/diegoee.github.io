<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"> 
    <title>Web Art5: AutoRegressive</title>   
    <style>  
      html,body{ 
        padding: 0;
        margin: 0;   
        background-color: #333;   
        color: #EEE;   
        -webkit-user-select: none;  
        -khtml-user-select: none;  
        -moz-user-select: none;  
        -ms-user-select: none;  
        user-select: none; 
        -webkit-tap-highlight-color: transparent; 
        font-family: 'Courier New', Courier, monospace; 
        overflow: hidden; 
      } 
      .btn{
        position: absolute;
        top: calc(50% - 20px);
        left: calc(50% - 50px);
        width: 100px;
        margin: 0;
        padding: 0; 
        border: 0;
        padding-top: 10px;
        padding-bottom: 10px;
      }
      .msg{
        position: absolute; 
        top: 0;
        right: 0; 
        margin: 0;
        padding: 0; 
        border: 0;
        
      }
    </style>   
  </head>
  <body>   
    <script type="text/javascript">  
      console.log('App');  
      art = { 
        end: false,
        init: function(idCanvas){  
          //variables app
          var canvas = document.getElementById(idCanvas);
          var ctx = canvas.getContext('2d');
          var signal = {
            x: [0],
            y: [canvas.height/2] 
          };     
          var i = 0; 
          var dir = true; 
          this.end = false;  

          function nextY(yAnt){  
            var nextY = yAnt + (canvas.height/40)*Math.random()*(Math.random()-0.5);
            if(nextY>canvas.height){
              nextY=canvas.height;
            }
            if(nextY<0){
              nextY=0;
            }
            return nextY;
          }

          // ani loop
          function animation(){ 
            if(dir){
              i++;
              if(i>canvas.width){
                dir = false;  
              }
            }else{
              i--;
              if(i<0){
                dir = true; 
              }
            }     
            signal.y.push(nextY(signal.y[signal.y.length-1]));  
            signal.x.push(i); 
          }

          for (var ii=0; ii<canvas.width/2; ii++){       
            animation();
          }

          //plot element
          function plot(){ 
            var radius = 1;
            ctx.clearRect(0, 0, canvas.width, canvas.height);  
            for (var i=0; i<signal.x.length-1; i++){  
              ctx.beginPath(); 
              ctx.arc(signal.x[i], signal.y[i], radius, 0, 2*Math.PI, false);  
              ctx.fillStyle  = '#EEE'; 
              ctx.strokeStyle = ctx.fillStyle;
              ctx.fill();
              ctx.stroke();
            }   
          }   

          //exe 
          var that = this;
          function loop(){ 
            animation();
            plot();  
            if(!that.end){
              requestAnimationFrame(loop);
            }
          } 
          requestAnimationFrame(loop);    
        } 
      }

      dom = {
        removeE: function(id){ 
          var e = document.querySelector('#'+id); 
          if(e!==null){ 
            e.parentNode.removeChild(e);
          }
        },
        createCanvas: function(id){
          var canvas = document.createElement('canvas');    
          canvas.id = id;
          canvas.setAttribute('width', window.innerWidth); 
          canvas.setAttribute('height', window.innerHeight);
          //canvas.setAttribute('width', 300); 
          //canvas.setAttribute('height', 300);
          //canvas.style.border = "2px solid #DDD";
          return canvas; 
        },
        prependToBody: function(e){ 
          document.body.prepend(e); 
        },
        createButtonStart: function(id){
          var button = document.createElement('button');    
          button.id = id;      
          button.setAttribute('class', 'btn');  
          button.innerHTML = 'Start';   
          var that = this;
          button.addEventListener('click', function (e) { 
            that.removeE('btn');
            that.prependToBody(that.createCanvas('canvas'));  
            art.init('canvas'); 
          }); 
          return button; 
        },
        createMsg: function(text){
          var msg = document.createElement('p');    
          msg.id = 'msg';      
          msg.setAttribute('class', 'msg');  
          msg.innerHTML = text; 
          return msg; 
        }, 
        holdTimer: null,
        holdDelay: 1000,
        holdActive: false,
        clickDownWin: function(){
          //console.log('click Down');  
          dom.holdTimer = setTimeout(function() {
            dom.holdTimer = null;
            dom.holdActive = true;   
            dom.removeE('msg');
            dom.prependToBody(dom.createMsg('Reset...'));  
	        }, dom.holdDelay); 
        }, 
        clickUpWin: function(){
          //console.log('click Up');  
          dom.removeE('msg');
          if(dom.holdTimer){
		        clearTimeout(dom.holdTimer);    
	        }else if (dom.holdActive) {
		        dom.holdActive = false; 
            dom.init(); 
	        } 
        },
        exe: function(){ 
          art.end=true;
          dom.removeE('btn');
          dom.removeE('canvas');
          dom.prependToBody(dom.createButtonStart('btn')); 
          window.removeEventListener('resize', this.exe); 
          window.addEventListener('resize', this.exe);   
          window.removeEventListener('mousedown', this.clickDownWin); 
          window.addEventListener('mousedown', this.clickDownWin);   
          window.removeEventListener('mouseup', this.clickUpWin); 
          window.addEventListener('mouseup', this.clickUpWin);   
        },
        init: function(){ 
          this.exe();  
          document.getElementById('btn').click();  
        }
      }     
      dom.init();   
    </script>
  </body>
</html>

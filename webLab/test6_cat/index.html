<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"> 
    <title>Web Test6_cat</title> 
    <style>  
      html,body{ 
        padding: 0;
        margin: 0;  
        background-color: #333;  
        color: #DDD
      }
      body{  
        display: flex;
        align-items: center;
        justify-content: center;
      }  
    </style>   
  </head>
  <body>    
    <main></main>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>     
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js"></script> 
    <script type="text/javascript"> 
      console.log('Exe start'); 
 
      var app = {
        getRandomN: function(min, max){
          return Math.round(Math.random() * (max - min) + min);
        },
        getRandomB: function() {
          return Math.random()<0.5?0:1;
        }, 
        circle: {
          x: undefined,
          y: undefined,
          r: undefined,
          xEnd: undefined,
          yEnd: undefined
        },
        idCountercircleClick: 0,
        circlesClick: [],
        addCircleClick: function (x,y){ 
          var self = this;
          self.idCountercircleClick++;
          self.circlesClick.push({ 
            clickAni: 1,
            id: self.idCountercircleClick,
            x: x,
            y: y,
            r: 10,
            rEnd: self.getRandomN(5,15),
            o: 255, 
            oEnd: self.getRandomN(100,255),
          });  
        },
        plot: function (){ 
          fill(221, 221, 221, 255);
          ellipse(this.circle.x, this.circle.y, this.circle.r, this.circle.r);   
          for (var i=0; i<this.circlesClick.length; i++){ 
            fill(221, 221, 221,this.circlesClick[i].o);
            ellipse(this.circlesClick[i].x, this.circlesClick[i].y, this.circlesClick[i].r, this.circlesClick[i].r); 
          } 
        },
        animation: function(){  
          var seft = this;
          function collisionCircle(circ1,circ2){   
            var dis = dist(circ1.x, circ1.y, circ2.x, circ2.y);
            if (dis < circ1.r + circ2.r - 20){//20 ¿?¿?
              return true;
            }else{
              return false;
            }
          }
          function removeObjectWithId(arr,id){
            var arrCopy = Array.from(arr); 
            var objWithIdIndex = arrCopy.findIndex(function(obj){
              return obj.id === id
            });
            arrCopy.splice(objWithIdIndex, 1);
            return arrCopy;
          } 

          var removeCircle=[];
          this.circlesClick.forEach(function(e,i){  
            if(collisionCircle(e,seft.circle)){ 
              removeCircle.push(seft.circlesClick[i].id);
            }
          });  
          removeCircle.forEach(function(e,i){  
            seft.circlesClick=removeObjectWithId(seft.circlesClick,e);
          });   

          this.circlesClick.forEach(function(e,i){ 
            if(e.clickAni!==0){
              e.r=e.r+e.clickAni*5;
              e.o=e.o-e.clickAni*5; 
              if(e.r>50){
                e.clickAni=-1; 
              }
              if(e.r<10){
                e.clickAni=0;
              }
            }else{ 
              if(e.o>e.oEnd){
                e.o=e.o-5;
              }
              if(e.o<e.oEnd){
                e.o=e.o+5;
              }
              if(e.r>e.rEnd){
                e.r=e.r-0.025;
              }
              if(e.r<e.rEnd){
                e.r=e.r+0.025;
              }
            }
          });  
 
          //circle move
          if (this.circle.x>this.circle.xEnd){
            this.circle.x=this.circle.x-1;   
          }
          if (this.circle.x<this.circle.xEnd){
            this.circle.x=this.circle.x+1;   
          }
          if (this.circle.x===this.circle.xEnd){
            this.circle.xEnd=this.getRandomN(0,width);   
          } 
          if (this.circle.y>this.circle.yEnd){
            this.circle.y=this.circle.y-1; 
          }
          if (this.circle.y<this.circle.yEnd){
            this.circle.y=this.circle.y+1;   
          }
          if (this.circle.y===this.circle.yEnd){
            this.circle.yEnd=this.getRandomN(0,height);   
          } 

        },
        //exe in mousePressed
        mousePressed: function(mouseX,mouseY){   
          this.addCircleClick(mouseX,mouseY);  
        },  
        //exe in setup
        setup: function(){ 
          createCanvas($(window).width()-6, $(window).height()-6);
          frameRate(60);
          background(color(51));
          noStroke(); 
          this.circle.x = width/2;
          this.circle.y = height/2;
          this.circle.r = (width<width?width*0.05:height*0.05); 
          this.circle.xEnd = this.getRandomN(0,width);
          this.circle.yEnd = this.getRandomN(0,height);

          for(var i=0; i<width; i++){
            for(var ii=0; ii<height; ii++){
              if(Math.random()<0.0005){ 
                this.addCircleClick(i,ii); 
              }
            }
          }  
        },
        //exe in draw
        draw: function(){ 
          background(color(51));    
          this.animation();   
          this.plot();  
        }
      };
 
      //https://p5js.org/es/examples/
      function setup(){ 
        app.setup();  
      }
 
      function draw(){ 
        app.draw();  
      } 

      function mousePressed(){   
        app.mousePressed(mouseX,mouseY);  
      } 

      $(window).on('resize',function(){
        location.reload();  
      });   
      console.log('Exe end');   
    </script>
  </body>
</html>

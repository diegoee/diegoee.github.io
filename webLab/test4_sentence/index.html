<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Web test"> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.4.0/dist/css/uikit.min.css" />  
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <title>Web Test4_sentence</title>
    <style> 
      #loading{
        background-color: rgb(255,255,255,0.85);
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 100000;
        display: flex;
        align-items: center;
        justify-content: center; 
        opacity: 0.75;
      }  
      .aligner {
        display: flex;
      }  
      .aligner-item {
        margin:auto;
      } 
      .wSen{
        width: 80%; 
        padding: 1em;
      } 
      .wfilter{
        width: 90%; 
      }
      .btnSentence{
        cursor: pointer;
      }  
      .mt{
        margin-top: 0.5em;
      }
      .whiteText{
        color: white;
      }
      #filterLabel{
        position: fixed;
        top: 0;
        right: 0; 
        margin: 1em;
      }
      #timeLabel{
        position: fixed;
        bottom: 0;
        left: 0; 
        margin: 1em;  
      }
      @media screen and (min-width: 600px) {
        .wfilter{ 
          width: 50%; 
        }
        .wSen{
          width: 75%; 
        } 
      }
      @media screen and (min-width: 1024px) {
        .wfilter{ 
          width: 30%; 
        } 
        .wSen{
          width: 65%; 
        } 
      } 
      .buzz{
        animation: tiembla 0.1s;
        animation-iteration-count: 3;
      }
      @keyframes tiembla{
        0%  { -webkit-transform:rotateZ(-1deg); }
        50% { -webkit-transform:rotateZ( 0deg) scale(.9); }
        100%{ -webkit-transform:rotateZ( 1deg); }
      }    
    </style>
  </head>
  <body>   
    <div id="loading"> 
      <div uk-spinner="ratio: 3"></div>
    </div> 
    <div id="app" class="aligner">      
      <div class="aligner-item wfilter">   
        <div class="uk-inline uk-width-1-1" id="inputTextContainer">
          <span class="uk-form-icon" uk-icon="comment"></span>  
          <input class="uk-input" id="inputText" type="text" placeholder="filtrar por ..." placeholder="100">
        </div> 
        <div class="uk-width-1-1 uk-text-center mt">   
          <button class="uk-button uk-button-default uk-button-small" id="btnGo"><span class="uk-margin-small-right" uk-icon="search"></span> Buscar</button> 
        </div>  
      </div> 
    </div>
    <div id="containerSen"></div> 
    <span id="filterLabel" class="uk-label"></span>
    <span id="timeLabel" class="uk-label-danger"></span>    
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script> 
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/uikit@3.4.0/dist/js/uikit.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/uikit@3.4.0/dist/js/uikit-icons.min.js"></script> 
    <script type="text/javascript"> 
      (function exe(){   
        function onOffLoading(state){ 
          if(state){
            $('#loading').css({
              display: 'flex'
            });
          }else{
            $('#loading').css({
              display: 'none'
            });
          } 
        } 
        onOffLoading(true);  
        $('#inputText').on('focus',function(){ 
          $('#inputTextContainer span').attr('uk-icon','commenting');
          $('#inputTextContainer').addClass('buzz').on('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(){ 
            $(this).removeClass('buzz'); 
          });
          $(document).on('keydown', function(e){ 
            if(e.keyCode===13){
              $('#btnGo').trigger('click');
            }
          }); 
        });    
        $('#inputText').on('focusout',function(){ 
          $(document).off('keydown');
          $('#inputTextContainer span').attr('uk-icon','comment');
        }); 
        $('#btnGo').on('click',function(){ 
          var start = new Date();  
          $('#timeLabel').html(' '); 
          onOffLoading(true);  
          setTimeout(function(){ 
            filterData($('#inputText').val());
            createFilterLabel($('#inputText').val());
            createSentence();  
            if(!($('#inputText').val()===null||$('#inputText').val()===undefined||$('#inputText').val().replace(/\s/g,'')==='')){ 
              $('#timeLabel').html('<button type="button" class="uk-button uk-button-text"><span class="wSen whiteText">Last exe search: '+((new Date()).getTime()-start.getTime())+'ms</span></button>');
              $('#timeLabel button').on('click',function(){ 
                $('#timeLabel').html(' '); 
              }); 
            }
          },250); 
        });         
                
        function adaptedText(textToAdapt,decodeHTMLEntities){ 
          var textUpdated = textToAdapt; 
          var from = "ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÑñÇç";
          var to   = "AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuuNnCc";
          function setCharAt(str,index,chr) {
              if(index > str.length-1) return str;
              return str.substr(0,index) + chr + str.substr(index+1);
          }
          decodeHTMLEntities = decodeHTMLEntities===undefined?false:decodeHTMLEntities;
          if(decodeHTMLEntities){  
            $('#textArea').remove();
            textUpdated = $('<textarea id="textArea"></textarea>').html(textUpdated).text();
            $('#textArea').remove();  
          }
          for(var i = 0; i<textUpdated.length; i++){
            if(from.indexOf(textUpdated[i])!==-1){ 
              textUpdated = setCharAt(textUpdated,i,to[from.indexOf(textUpdated[i])]);                
            }
          }
          textUpdated = textUpdated.toUpperCase();
          return textUpdated;
        }
        function filterData(text){  
          if(text===null||text===undefined||text.replace(/\s/g,'')===''){
            dataFilter = dataSen;
          }else{  
            dataFilter = dataSen.filter(function(value, index){
              var inElem = false;
              if(adaptedText(value.sentence,true).indexOf(adaptedText(text))!==-1){ 
                inElem = true;
              } 
              if(adaptedText(value.author,true).indexOf(adaptedText(text))!==-1){  
                inElem = true;
              }
              return inElem;
            });
          }
        }
        
        function createFilterLabel(text){
          if(text===null||text===undefined||text.replace(/\s/g,'')===''){
            $('#filterLabel').html('<button type="button" class="uk-button uk-button-text"><span class="whiteText" uk-icon="icon: chevron-up"></span></button>');
          }else{
            $('#filterLabel').html('<button type="button" class="uk-button uk-button-text"><span class="wSen whiteText">Filter by: '+adaptedText(text)+''+(dataFilter.length===0?' (0 results)':'')+'</span><span class="whiteText" uk-icon="icon: chevron-up"></span></button>');
          }
          $('#filterLabel button').on('click',function(){  
              onOffLoading(true);
              $('#filterLabel').html(' ');
              $('#inputText').val(' ');
              $('html, body').animate({ 
                scrollTop: 0 
              },{
                easing: 'swing',
                duration: 1500,
                complete: function(){                   
                  $('#containerSen').html(' ');
                  onOffLoading(false);
                }
              });
            });
        }
 
        var templateCard = '<div><div class="aligner"><div class="aligner-item wSen btnSentence uk-card-default uk-card-hover"><p class="sentence uk-text-secondary uk-text-large"></p><p class="uk-text-emphasis uk-text-small">Author: <span class="author uk-text-muted"></span></p></div></div></div>';
        function createSentence(){ 
          onOffLoading(true);
          if(dataFilter.length>0){
            var pos = Math.floor(Math.random()*(dataFilter.length-1))+0;
            var $card = $(templateCard);
            $card.find('.sentence').html(dataFilter[pos].sentence);
            $card.find('.author').html(dataFilter[pos].author);
            $('#containerSen').append($card.html());
            $('.aligner').innerHeight($(window).innerHeight());
            $('.btnSentence').off('click');
            $('.btnSentence').on('click', function(){
              createSentence();
            }); 
            $('html, body').animate({ 
              scrollTop: $(document).height() 
            },{
              easing: 'swing',
              duration: 1500,
              complete: function(){ 
                onOffLoading(false);
              }
            });
          }else{
            onOffLoading(false);
          }
        }  
        
        function resize(){   
          $('.aligner').innerHeight($(window).innerHeight());  
          $('#inputText').val(''); 
          $('#btnGo').trigger('click'); 
          onOffLoading(false);
        }   

        var dataSen = [{
            sentence: 'null',
            author: 'null',
        }];
        var dataFilter = {};

        $.ajax({
          url: 'sentence.json',
          type: 'get',  
          success: function (data){ 
            dataSen = data; 
            dataFilter = dataSen;
            resize();
            $(window).on('resize',resize); 
          },
          error: function (jqXHR){   
            if (jqXHR.status===401){   
              toast(jqXHR.responseText); 
            }else{ 
              toast(jqXHR.statusText); 
            }              
          }
        });
         
      })();
    </script>
    <noscript>JAVASCRIPT NOT WORKING!</noscript>
  </body>
</html>

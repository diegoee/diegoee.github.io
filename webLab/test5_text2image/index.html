<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Web test">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" > 
    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.4.0/dist/css/uikit.min.css" />    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <title>Web Test5_text2image</title>
    <style> 
      #loading{
        background-color: rgb(255,255,255,0.85);
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 100000;
        display: flex;
        align-items: center;
        justify-content: center; 
        opacity: 0.75;
      }  
      .aligner {
        display: flex;
      }   
      .aligner-item {
        margin:auto;
        width: 90%; 
      }
      .mt{
        margin-top: 0.5em;
      }     
      @media screen and (min-width: 600px) {
        .aligner-item{ 
          width: 50%; 
        } 
      }
      @media screen and (min-width: 1024px) {
        .aligner-item{ 
          width: 30%; 
        } 
      } 
      .buzz{
        animation: tiembla 0.1s;
        animation-iteration-count: 3;
      }
      @keyframes tiembla{
        0%  { -webkit-transform:rotateZ(-1deg); }
        50% { -webkit-transform:rotateZ( 0deg) scale(.9); }
        100%{ -webkit-transform:rotateZ( 1deg); }
      }
      </style>
  </head>
  <body>   
    <div id="loading"> 
      <div uk-spinner="ratio: 3"></div>
    </div> 
    <div id="app" class="aligner">      
      <div class="aligner-item">   
        <div class="uk-inline uk-width-1-1" id="inputTextContainer">
          <span class="uk-form-icon" uk-icon="comment"></span>  
          <input class="uk-input" id="inputText" type="text" placeholder="write, please ..." placeholder="100">
        </div> 
        <div class="uk-width-1-1 uk-text-center mt">   
          <button class="uk-button uk-button-default uk-button-small" id="btnGo"><span class="uk-margin-small-right" uk-icon="happy"></span> Go! </button> 
        </div>  
      </div> 
    </div> 
    <div id="modal-center" class="uk-flex-top" uk-modal>
      <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical">
        <button class="uk-modal-close-default" type="button" uk-close></button> 
        <div id="modalContainer"></div>
      </div>
    </div>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <!-- UIkit JS -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.4.0/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.4.0/dist/js/uikit-icons.min.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/3.6.2/fabric.min.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/6.6.2/math.min.js"></script>  
    <script type="text/javascript"> 
      (function exe(){   
        function onOffLoading(state){ 
          if(state){
            $('#loading').css({
              display: 'flex'
            });
          }else{
            $('#loading').css({
              display: 'none'
            });
          } 
        } 
        onOffLoading(true);  
           
        $('#inputText').on('focus',function(){ 
          $('#inputTextContainer span').attr('uk-icon','commenting');
          $('#inputTextContainer').addClass('buzz').on('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(){ 
            $(this).removeClass('buzz'); 
          });
          $(document).on('keydown', function(e){ 
            if(e.keyCode===13){
              $(document).off('keydown');
              $('#btnGo').trigger('click');
            }
          }); 
        });    
        $('#inputText').on('focusout',function(){ 
          $('#inputTextContainer span').attr('uk-icon','comment');
        }); 
        $('#btnGo').on('click',function(){    
          search($('#inputText').val()); 
        });  
         
        var stop = false;
        function search(text){ 
          onOffLoading(true);   
          UIkit.modal('#modal-center').show(); 
          $('#modal-center').one('shown',function(){  
            stop = false;
            createCanvas();
          }); 
          $('#modal-center').one('hide',function(){ 
            stop = true;
          }); 
          function createCanvas(){ 
            $('#modalContainer').html('<canvas id="canvas"></canvas>'); 
              $('#canvas').css({ 
                'border-radius': '5px', 
                'border': 'solid 1px',
                'border-color': 'rgba(0, 0, 0, 0.05)' 
              });
            var canvas = new fabric.Canvas('canvas',{ 
              selection: false,
              preserveObjectStacking: true,
              originX: 'center',
              originY: 'center',
              width: $('#modalContainer').innerWidth(), 
              height: $(window).innerHeight()-175             
            });   

            // START. Invención...
            // ASCII secret text 2 image...  
            if (text.length<2||text===undefined||text===null){
              text='AB';
            } 

            var coor = [];   
            var xx = [];   
            var yy = [];   
            for(var i=0; i<text.length; i++){ 
              var x = 0;
              var y = 0;
              if (i<text.length-1){
                y = (text.charCodeAt(i)-text.charCodeAt(i+1));
              }else{
                y = (text.charCodeAt(i)-text.charCodeAt(0));
              }
              if (i>0){
                x = (text.charCodeAt(i-1)-text.charCodeAt(i));
              }else{
                x = (text.charCodeAt(text.length-1)-text.charCodeAt(0));
              } 
              xx.push(x); 
              yy.push(y); 
            } 
            for(var i=0; i<xx.length; i++){ 
              coor.push([canvas.width*(xx[i]-math.min(xx))/(math.max(xx)-math.min(xx)),canvas.height*(yy[i]-math.min(yy))/(math.max(yy)-math.min(yy))]);  
            }  
            // END: Invención...
            onOffLoading(false); 
 
            function create_line(i){
              //line : [x1, y1, x2, y2]
              var line = new fabric.Line([coor[i-1][0], coor[i-1][1], coor[i-1][0], coor[i-1][1]],{
                fill: 'black',
                stroke: 'black',
                strokeWidth: 1, 
                selectable: false,
                evented: false,
              }); 
              canvas.add(line); 
              canvas.renderAll();

              line.animate({ 
                  x2: coor[i][0],
                  y2: coor[i][1], 
                },{
                duration: 100,
                onChange: canvas.renderAll.bind(canvas),
                onComplete: function(){     
                  if(i+1<coor.length&&!stop){
                    create_line(i+1);
                  }else{ 
                    $('#canvas').css({  
                      'border-color': 'rgba(0, 0, 0, 1)' 
                    });
                  }            
                },
                easing: fabric.util.ease.easeOutBack
              });
            } 
            create_line(1);  
          }
        }

        function resize(){      
          $('.aligner').innerHeight($(window).innerHeight()); 
          onOffLoading(false);    
        }
        resize();
        $(window).on('resize',resize); 
      })();
    </script>
    <noscript>JAVASCRIPT NOT WORKING!</noscript>
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"> 
    <title>Web Test6_art</title> 
    <style>  
      html,body{ 
        padding: 0;
        margin: 0;  
        background-color: #333;  
        color: #DDD
      }
      body{  
        display: flex;
        align-items: center;
        justify-content: center;
      }  
      #actionBtn{
        position: absolute;
        top: 0;
        right: 0;
        margin: 10px;
        font-size: 1.5em;
      }
    </style>   
  </head>
  <body>    
    <button id="actionBtn"> Next </button>
    <main></main>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>     
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js"></script> 
    <script type="text/javascript"> 
      console.log('Exe start'); 
      var app = [];
      appPlay= 0; 
       
      app[0] = {
        getRandomN: function(min, max){
          return Math.round(Math.random() * (max - min) + min);
        }, 
        idCountercircleClick: 0,
        circlesClick: [],
        addCircleClick: function (x,y){ 
          var self = this;
          self.idCountercircleClick++;
          self.circlesClick.push({ 
            clickAni: 1,
            id: self.idCountercircleClick,
            x: x,
            y: y,
            r: 10,
            rEnd: self.getRandomN(5,15),
            o: 255, 
            oEnd: self.getRandomN(100,255),
            lifeCounter: 0,
            lifeTime: self.getRandomN(1000,10000),
          });  
        }, 
        plot: function (){ 
          noStroke();   
          for (var i=0; i<this.circlesClick.length; i++){ 
            fill(221, 221, 221,this.circlesClick[i].o);
            ellipse(this.circlesClick[i].x, this.circlesClick[i].y, this.circlesClick[i].r, this.circlesClick[i].r); 
          }   
        },
        animation: function(){  
          var self = this;
          function collisionCircle(circ1,circ2){   
            var dis = dist(circ1.x, circ1.y, circ2.x, circ2.y);
            if (dis < circ1.r + circ2.r - 20){//20 ¿?¿?
              return true;
            }else{
              return false;
            }
          }
          function removeObjectWithId(arr,id){
            var arrCopy = Array.from(arr); 
            var objWithIdIndex = arrCopy.findIndex(function(obj){
              return obj.id === id
            });
            arrCopy.splice(objWithIdIndex, 1);
            return arrCopy;
          }  
          if(Math.random()<0.0125){ 
            this.addCircleClick(self.getRandomN(0,width),self.getRandomN(0,height)); 
          }

          var removeCircle=[];
          this.circlesClick.forEach(function(e,i){
            e.lifeCounter++;     
            if(e.lifeCounter>e.lifeTime){ 
              removeCircle.push(e.id);
            }
          });  
          removeCircle.forEach(function(e,i){  
            self.circlesClick = removeObjectWithId(self.circlesClick,e);
          });   

          this.circlesClick.forEach(function(e,i){ 
            if(e.clickAni!==0){
              e.r=e.r+e.clickAni*5;
              e.o=e.o-e.clickAni*5; 
              if(e.r>50){
                e.clickAni=-1; 
              }
              if(e.r<10){
                e.clickAni=0;
              }
            }else{ 
              if(e.o>e.oEnd){
                e.o=e.o-5;
              }
              if(e.o<e.oEnd){
                e.o=e.o+5;
              }
              if(e.r>e.rEnd){
                e.r=e.r-0.025;
              }
              if(e.r<e.rEnd){
                e.r=e.r+0.025;
              }
            }
          });    
        },
        //exe in mousePressed
        mousePressed: function(mouseX,mouseY){   
          this.addCircleClick(mouseX,mouseY);  
        },  
        //exe in setup
        setup: function(){   
          for(var i=0; i<width; i++){
            for(var ii=0; ii<height; ii++){
              if(Math.random()<0.0005){ 
                this.addCircleClick(i,ii); 
              }
            }
          }      
        },
        //exe in draw
        draw: function(){ 
          background(color(51));    
          this.animation();   
          this.plot();  
        }
      };

      app[1] = { 
        getRnd: function(min, max){
          return Math.round(Math.random() * (max - min) + min);
        }, 
        signal: {
          c:[], 
          x:[], 
          y:[],
          r:[] 
        },
        plot: function (){ 
          noStroke(); 
          for (var i=0; i<this.signal.x.length; i++){   
            fill(this.signal.c[i]); 
            ellipse(this.signal.x[i], this.signal.y[i], this.signal.r[i], this.signal.r[i]); 
          }
        },
        animation: function(){  
          for (var i=0; i<this.signal.y.length; i++){  
            this.signal.y[i]=this.signal.y[i]+this.getRnd(-1,1); 
            if(this.signal.y[i]<0||this.signal.y[i]>height){
              this.signal.y[i]=height/2;
              this.signal.r[i]++;
            }
          }
        },
        //exe in mousePressed
        mousePressed: function(mouseX,mouseY){   
        },  
        //exe in setup
        setup: function(){  
          //https://p5js.org/es/reference/  
          for (var i=0; i<width; i++){ 
            if(this.getRnd(0,50)===1){ 
              this.signal.y.push(this.getRnd(250,height-250));
              this.signal.c.push('#000');
              this.signal.r.push(8);
            }else{ 
              this.signal.y.push(height/2);
              this.signal.c.push('#DDD');
              this.signal.r.push(5);
            }
            this.signal.x.push(i);
          }  
        },
        //exe in draw
        draw: function(){ 
          background(color(51));    
          this.animation();   
          this.plot();  
        }
      };

      app[2] = {
        getRnd: function(min, max){
          return Math.round(Math.random() * (max - min) + min);
        },  
        ecgData: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,          
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,           
          0.08, 0.18, 0.08, 0, 0, 0, 0, 0, 0, -0.04,           
          -0.08, 0.3, 0.7, 0.3, -0.17, 0.00, 0.04, 0.04, 
          0.05, 0.05, 0.06, 0.07, 0.08, 0.10, 0.11, 0.11,           
          0.10, 0.085, 0.06, 0.04, 0.03, 0.01, 0.01, 0.01,           
          0.01, 0.02, 0.03, 0.05, 0.05, 0.05, 0.03, 0.02, 0, 0, 0
        ], 
        signal: { 
          x:[], 
          y:[],
          c:[],
          p:[], 
        },
        plot: function (){  
          for (var i=0; i<this.signal.x.length-1; i++){ 
            stroke(this.signal.c[i]);  
            line(this.signal.x[i], this.signal.y[i], this.signal.x[i+1], this.signal.y[i+1]); 
            if(this.signal.p[i]){
              ellipse(this.signal.x[i], this.signal.y[i], 4, 4);
            }
          } 
        },
        startAni: true,
        animation: function(){ 
          //this.startAni=false;
          if(this.startAni){ 
            var e = this.signal.c.pop();
            this.signal.c.unshift(e);  
            var e = this.signal.p.pop();
            this.signal.p.unshift(e);   
          }  
        },
        //exe in mousePressed
        mousePressed: function(mouseX,mouseY){  
          this.startAni=!this.startAni; 
        },  
        //exe in setup
        setup: function(){  
          //https://p5js.org/es/reference/  
          var aux = []; 
          for (var i=0; i<this.ecgData.length; i++){ 
            for (var ii=0; ii<2; ii++){   
              aux.push(this.ecgData[i]);  
            } 
          } 
          aux = aux.map(function(e) {
            return 3*height/4-(1*height/2)*(e+0.025*Math.random());
          }); 
          var l = aux.length;  
          var opac = 0;
          var exe = true;
          var count = 0;
          for (var i=0; i<width; i++){  
            this.signal.p.push(false);
            this.signal.x.push(i); 
            this.signal.y.push(aux[i % aux.length]); 
            if(opac>1){ 
              this.signal.c.push('rgba(221, 221, 221, 0)');
            }else{
              count++;
              opac=opac+0.0055;
              this.signal.c.push('rgba(221, 221, 221, '+opac+')');
            } 
          }   
          this.signal.p[count]=true
        },
        //exe in draw
        draw: function(){ 
          background(color(51));    
          this.animation();   
          this.plot();  
        }
      };
      
      
      //https://p5js.org/es/examples/
      function setup(){ 
        createCanvas($(window).width()-6, $(window).height()-6);
        frameRate(60);
        for(var i=0; i<app.length; i++){
          app[i].setup();  
        } 
      }
 
      function draw(){ 
        app[appPlay].draw();  
      } 

      function mousePressed(){   
        app[appPlay].mousePressed(mouseX,mouseY);  
      }  

      $(window).on('resize',function(){
        location.reload();  
      });  

      $('#actionBtn').on('click',function(){
        appPlay++;
        if(appPlay>=app.length){
          appPlay=0;
        }  
      }); 
      console.log('Exe end');   
    </script>
  </body>
</html>

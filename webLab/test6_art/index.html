<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"> 
    <title>Web Test6_art</title> 
    <style>   
      html,body{ 
        padding: 0;
        margin: 0;  
        background-color: #333;  
        color: #DDD;
        -webkit-user-select: none;  
        -khtml-user-select: none;  
          -moz-user-select: none;  
            -ms-user-select: none;  
                user-select: none; 
        -webkit-tap-highlight-color: transparent; 
      }
      body{  
        display: flex;
        align-items: center;
        justify-content: center;
      }  
      #actionBtn{
        position: absolute;
        top: 0;
        right: 0;
        margin: 10px;
        font-size: 1.5em;
        cursor: pointer;
      }
    </style>   
  </head>
  <body>    
    <button id="actionBtn"> Next </button>
    <main></main>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>     
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js"></script> 
    <script type="text/javascript"> 
      console.log('Exe start'); 
      sketchs = [];

      aux = {
        getRandomN: function(min, max){
          return Math.round(Math.random() * (max - min) + min);
        }, 
        idCounterCircleClick: 0,
        circlesClick: [],
        addCircleClick: function (x,y){ 
          var self = this;
          self.idCounterCircleClick++;
          self.circlesClick.push({ 
            clickAni: 1,
            id: self.idCounterCircleClick,
            x: x,
            y: y,
            r: 10,
            rEnd: self.getRandomN(5,15),
            o: 255, 
            oEnd: self.getRandomN(100,255),
            lifeCounter: 0,
            lifeTime: self.getRandomN(1000,10000),
          });  
        }, 
        plot: function (){ 
          noStroke();   
          for (var i=0; i<this.circlesClick.length; i++){ 
            fill(221, 221, 221,this.circlesClick[i].o);
            ellipse(this.circlesClick[i].x, this.circlesClick[i].y, this.circlesClick[i].r, this.circlesClick[i].r); 
          }   
        }, 
        animation: function(){  
          var self = this; 
          function removeObjectWithId(arr,id){
            var arrCopy = Array.from(arr); 
            var objWithIdIndex = arrCopy.findIndex(function(obj){
              return obj.id === id
            });
            arrCopy.splice(objWithIdIndex, 1);
            return arrCopy;
          }  
          if(Math.random()<0.0125){ 
            this.addCircleClick(self.getRandomN(0,width),self.getRandomN(0,height)); 
          }

          var removeCircle=[];
          this.circlesClick.forEach(function(e,i){
            e.lifeCounter++;     
            if(e.lifeCounter>e.lifeTime){ 
              removeCircle.push(e.id);
            }
          });  
          removeCircle.forEach(function(e,i){  
            self.circlesClick = removeObjectWithId(self.circlesClick,e);
          });   

          this.circlesClick.forEach(function(e,i){ 
            if(e.clickAni!==0){
              e.r=e.r+e.clickAni*5;
              e.o=e.o-e.clickAni*5; 
              if(e.r>50){
                e.clickAni=-1; 
              }
              if(e.r<10){
                e.clickAni=0;
              }
            }else{ 
              if(e.o>e.oEnd){
                e.o=e.o-5;
              }
              if(e.o<e.oEnd){
                e.o=e.o+5;
              }
              if(e.r>e.rEnd){
                e.r=e.r-0.025;
              }
              if(e.r<e.rEnd){
                e.r=e.r+0.025;
              }
            }
          });    
        },
        //exe in mouseClicked
        mouseClicked: function(mouseX,mouseY){   
          this.addCircleClick(mouseX,mouseY);  
        },  
        //exe in setup
        setup: function(){   
          for(var i=0; i<width; i++){
            for(var ii=0; ii<height; ii++){
              if(Math.random()<0.0005){ 
                this.addCircleClick(i,ii); 
              }
            }
          }      
        },
        //exe in draw
        draw: function(){ 
          background(color(51));    
          this.animation();   
          this.plot();  
        }
      };
      sketchs.push(aux);

      aux = { 
        getRnd: function(min, max){
          return Math.round(Math.random() * (max - min) + min);
        },  
        signal: [],
        clickedCircle: function (circ, point){   
          var dis = dist(circ.x, circ.y, point.x, point.y);
          if (dis < circ.r){
            return true;
          }else{
            return false;
          }
        },
        plot: function (){ 
          noStroke(); 
          for (var i=0; i<this.signal.length; i++){   
            fill(this.signal[i].c); 
            ellipse(this.signal[i].x, this.signal[i].y, this.signal[i].r, this.signal[i].r); 
          }   
        }, 
        animation: function(){  
          for (var i=0; i<this.signal.length; i++){  
            this.signal[i].y=this.signal[i].y+this.getRnd(-1,1); 
            if(this.signal[i].y<0||this.signal[i].y>height){
              this.signal[i].y=height/2;
              this.signal[i].r=this.signal[i].r+10;
            }
          } 
        },
        //exe in mouseClicked
        mouseClicked: function(mouseX,mouseY){ 
          var self = this;
          for (var i=0; i<this.signal.length; i++){  
            if(this.clickedCircle(this.signal[i],{
              x: mouseX,
              y: mouseY
            })){  
              this.signal=this.signal.filter(function(element, index, array){ 
                return element.x!==self.signal[i].x;
              });
              break;
            }
          } 
        },  
        //exe in setup
        setup: function(){  
          //https://p5js.org/es/reference/  
          for (var i=0; i<width; i=i+10){ 
            if(this.getRnd(0,50)===1){ 
              this.signal.push({
                x: i,
                y: this.getRnd(250,height-250),
                r: 20,
                c: '#000'
              }); 
            }else{ 
              this.signal.push({
                x: i,
                y: height/2,
                r: 15,
                c: '#DDD'
              });  
            } 
          }  
        },
        //exe in draw
        draw: function(){ 
          background(color(51));    
          this.animation();   
          this.plot();  
        }
      };
      sketchs.push(aux);

      aux = {
        getRnd: function(min, max){
          return Math.round(Math.random() * (max - min) + min);
        },  
        ecgData: [
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,          
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,           
          0.08, 0.18, 0.08, 0, 0, 0, 0, 0, 0, -0.04,           
          -0.08, 0.3, 0.7, 0.3, -0.17, 0.00, 0.04, 0.04, 
          0.05, 0.05, 0.06, 0.07, 0.08, 0.10, 0.11, 0.11,           
          0.10, 0.085, 0.06, 0.04, 0.03, 0.01, 0.01, 0.01,           
          0.01, 0.02, 0.03, 0.05, 0.05, 0.05, 0.03, 0.02, 0, 0, 0
        ], 
        signal: { 
          x:[], 
          y:[],
          c:[],
          p:[], 
        },
        plot: function (){  
          for (var i=0; i<this.signal.x.length-1; i++){ 
            fill('#DDD');  
            stroke(this.signal.c[i]);  
            line(this.signal.x[i], this.signal.y[i], this.signal.x[i+1], this.signal.y[i+1]); 
            if(this.signal.p[i]){
              ellipse(this.signal.x[i], this.signal.y[i], 4, 4);
            }
          }  
        }, 
        animation: function(){  
          var e = this.signal.c.pop();
          this.signal.c.unshift(e);  
          var e = this.signal.p.pop();
          this.signal.p.unshift(e);   
        },
        //exe in mouseClicked
        mouseClicked: function(mouseX,mouseY){   
          var step = this.getRnd(-10,10);   
          for (var i=0; i<this.signal.y.length; i++){  
            this.signal.y[i]=this.signal.y[i]+step;
          } 
        },  
        //exe in setup
        setup: function(){  
          //https://p5js.org/es/reference/  
          var aux = []; 
          for (var i=0; i<this.ecgData.length; i++){ 
            for (var ii=0; ii<2; ii++){   
              aux.push(this.ecgData[i]);  
            } 
          } 
          aux = aux.map(function(e) {
            return 3*height/4-(1*height/2)*(e+0.025*Math.random());
          }); 
          var l = aux.length;  
          var opac = 0;
          var exe = true;
          var count = 0;
          for (var i=0; i<width; i++){  
            this.signal.p.push(false);
            this.signal.x.push(i); 
            this.signal.y.push(aux[i % aux.length]); 
            if(opac>1){ 
              this.signal.c.push('rgba(221, 221, 221, 0)');
            }else{
              count++;
              opac=opac+0.0055;
              this.signal.c.push('rgba(221, 221, 221, '+opac+')');
            } 
          }   
          this.signal.p[count]=true
        },
        //exe in draw
        draw: function(){ 
          background(color(51));    
          this.animation();   
          this.plot();  
        }
      };
      sketchs.push(aux);

      aux = { 
        getRandomN: function(min, max){
          return Math.round(Math.random() * (max - min) + min);
        },
        beens: [],
        idBeen: 0,
        dBeen: 35,
        vMove: 10,
        counterLimit: 1000,
        collisionCircle: function (circ1,circ2){   
          var dis = dist(circ1.x, circ1.y, circ2.x, circ2.y);
          if (dis < this.dBeen){
            return true;
          }else{
            return false;
          }
        },
        addBeens: function (x,y){  
          this.idBeen++;
          this.beens.push({  
            id: this.idBeen,
            state: 1, //0: bad, 1: good, 2: again
            x: x,
            y: y, 
            color: '#DDD',
            counter: 0, 
            counterLimit: this.getRandomN(this.counterLimit/2,this.counterLimit)
          });  
        }, 
        plot: function(){   
          noStroke();   
          for (var i=0; i<this.beens.length; i++){ 
            fill(this.beens[i].color);
            ellipse(this.beens[i].x, this.beens[i].y, this.dBeen, this.dBeen); 
          }    
        }, 
        animation: function(){  
          for (var i=0; i<this.beens.length; i++){  
            this.beens[i].x=this.beens[i].x+this.vMove*(Math.random()-0.5); 
            this.beens[i].y=this.beens[i].y+this.vMove*(Math.random()-0.5); 
            if (this.beens[i].x<0){
              this.beens[i].x=0;  
            }
            if (this.beens[i].x>width){
              this.beens[i].x=width;
            }
            if (this.beens[i].y<0){
              this.beens[i].y=0;  
            }
            if (this.beens[i].y>height){
              this.beens[i].y=height;
            }
          }
          
          for (var i=0; i<this.beens.length; i++){  
            for (var ii=0; ii<this.beens.length; ii++){
              if(this.beens[i].id!==this.beens[ii].id){
                if(this.collisionCircle(this.beens[i],this.beens[ii])){ 
                  if(this.beens[i].state===1&&this.beens[ii].state===0){ 
                    this.beens[i].state=0;
                  }
                  if(this.beens[i].state===0&&this.beens[ii].state===1){ 
                    this.beens[ii].state=0;
                  }
                }
              }
            }
          }

          for (var i=0; i<this.beens.length; i++){  
            if(this.beens[i].state===0){ 
              this.beens[i].color='#111'; 
              this.beens[i].counter++;
              if(this.beens[i].counter>this.beens[i].counterLimit){
                this.beens[i].counter=0;
                this.beens[i].state=2;
              }
            }
            if(this.beens[i].state===1){ 
              this.beens[i].color='#DDD'; 
            }
            if(this.beens[i].state===2){ 
              this.beens[i].color='#555'; 
              this.beens[i].counter++;
              if(this.beens[i].counter>this.beens[i].counterLimit){
                this.beens[i].counter=0;
                this.beens[i].state=1;
              }
            }
          }  
        },
        //exe in mouseClicked
        mouseClicked: function(mouseX,mouseY){   
          for (var i=0; i<this.beens.length; i++){  
            if(this.beens[i].state===1 && this.collisionCircle(this.beens[i],{
              x: mouseX,
              y: mouseY
            })){ 
              this.beens[i].state=0;
              this.beens[i].counter=0; 
            }
          }
        },  
        //exe in setup
        setup: function(){  
          //https://p5js.org/es/reference/ 
          for (var i=this.dBeen; i<width; i=i+2*this.dBeen){ 
            for (var ii=this.dBeen; ii<height; ii=ii+2*this.dBeen){ 
              this.addBeens(i,ii); 
            } 
          }    
        },
        //exe in draw
        draw: function(){ 
          background(color(51));    
          this.animation();   
          this.plot();  
        }
      };
      sketchs.push(aux);

      aux = {  
        obj:{
          r: 20,
          x: 0,
          y: 0,
          xEnd: 0,
          yEnd: 0,
          xVel: 0,
          yVel: 0,
          round: 30
        },
        points:[],
        move: function(x,y){ 
          if(x<this.obj.s/2){
            x=this.obj.s/2;
          }
          if(x>width-this.obj.s/2){
            x=width-this.obj.s/2;
          }
          if(y<this.obj.s/2){
            y=this.obj.s/2;
          }
          if(y>height-this.obj.s/2){
            y=height-this.obj.s/2;
          }
          this.obj.xEnd = Math.round(x); 
          this.obj.yEnd = Math.round(y);
          var v = Math.abs(this.obj.x-this.obj.xEnd)/Math.abs(this.obj.y-this.obj.yEnd);
          if(v>1){
            v = Math.abs(this.obj.y-this.obj.yEnd)/Math.abs(this.obj.x-this.obj.xEnd);
            this.obj.xVel = 3*1; 
            this.obj.yVel = 3*v; 
          }else{
            this.obj.xVel = 3*v; 
            this.obj.yVel = 3*1; 
          }  
        }, 
        clicked: false,
        plot: function(){   
          noStroke();    
          fill('#DDD');
          circle(this.obj.x, this.obj.y, this.obj.r, this.obj.r); 
          if(this.clicked){  
            stroke('#DDD');   
            line(this.obj.x,this.obj.y,this.obj.xEnd,this.obj.yEnd); 
            noStroke();    
            circle(this.obj.xEnd,this.obj.yEnd,20,20); 
          }
          for(var i=0; i<this.points.length; i++){
            circle(this.points[i].x,this.points[i].y,5,5); 
          }  
        }, 
        animation: function(){ 
          var changePos = [this.obj.x,this.obj.y];
          if(this.obj.y<this.obj.yEnd){
            this.obj.y=this.obj.y+this.obj.yVel;  
          }
          if(this.obj.y>this.obj.yEnd){
            this.obj.y=this.obj.y-this.obj.yVel; 
          }
          if(this.obj.x<this.obj.xEnd){
            this.obj.x=this.obj.x+this.obj.xVel; 
          }
          if(this.obj.x>this.obj.xEnd){
            this.obj.x=this.obj.x-this.obj.xVel;  
          }   
          if(changePos[0]===this.obj.x||changePos[2]===this.obj.y){
            this.points.push({
              x: this.obj.x,
              y: this.obj.y
            });
            var x = Math.floor(Math.random()*width);
            var y = Math.floor(Math.random()*height);
            this.move(x,y); 
            this.clicked=false;
          }
        },
        //exe in mouseClicked
        mouseClicked: function(mouseX,mouseY){ 
           this.move(mouseX,mouseY);
           this.clicked=true;
        },  
        //exe in setup
        setup: function(){  
          //https://p5js.org/es/reference/ 
          this.obj.s = 30; 
          this.obj.x = width/2; 
          this.obj.y = height/2; 
          this.obj.round = 5;  
          var x = Math.floor(Math.random()*width);
          var y = Math.floor(Math.random()*height);
          this.move(x,y);  
        },
        //exe in draw
        draw: function(){ 
          background(color(51));    
          this.animation();   
          this.plot();  
        }
      };
      sketchs.push(aux); 

      app = { 
        time: 0,
        interval: undefined,
        intervalTime: 0,
        intervalTimeLimit: 30,
        createInterval: function(){
          var self = this;
          if(this.interval!==undefined){
            clearInterval(this.interval);
          }
          self.intervalTime=0;
          this.interval = setInterval(function(){
            self.intervalTime++;
            if (self.intervalTime>self.intervalTimeLimit){ 
              self.addCount();
              self.intervalTime=0;
            }
          },1000);
        },
        counter: 0,
        addCount: function(){
          this.createInterval();
          this.counter++;
          if(this.counter>=this.sketchs.length){
            this.counter=0;
          }
        },
        getTimeInMinSec: function(sec){ 
          //sec = (2*24*60*60+4*60*60+3*60+2) // 2dias 4horas 3min 2sec
          var seg   = sec%60; 
          var min   = Math.floor(sec%(60*60)/60); 
          var hours = Math.floor(sec%(60*60*24)/60/60);
          var days  = Math.floor(sec/(60*60*24)); 
          res = days+'d '+hours+':'+(min<9?'0'+min:min)+':'+(seg<9?'0'+seg:seg); 
          if(days===0){ 
            res = hours+':'+(min<9?'0'+min:min)+':'+(seg<9?'0'+seg:seg); 
          }
          if(days===0&&hours===0){ 
            res = (min<9?'0'+min:min)+':'+(seg<9?'0'+seg:seg); 
          }
          if(days===0&&hours===0&&min===0){ 
            res = (seg<9?'0'+seg:seg)+'s'; 
          }
          return res;
        },
        init: function(){
          this.sketchs = Array.from(sketchs); 
          this.counter = Math.floor(Math.random()*this.sketchs.length); 
          $(window).on('resize',function(){
            location.reload();  
          });      
          var self = this;
          $('#actionBtn').on('click',function(){
            self.addCount();
          });  
          this.createInterval();
          setInterval(function(){
            self.time++;  
          },1000);
        }
      }
      app.init();     
      delete sketchs;   
      delete aux; 

      //https://p5js.org/es/examples/
      function setup(){ 
        createCanvas($(window).width()-6, $(window).height()-6);
        frameRate(60);
        for(var i=0; i<app.sketchs.length; i++){
          app.sketchs[i].setup();  
        } 
      }
 
      function draw(){  
        background(color(51)); 
        app.sketchs[app.counter].draw();  
        noStroke();       
        textAlign(LEFT);
        textSize(18);
        fill(0);
        text('Art '+(app.counter+1)+'/'+app.sketchs.length+': '+app.getTimeInMinSec(app.intervalTime)+' ('+app.getTimeInMinSec(app.intervalTimeLimit)+')', 10, 30);
        text('Time: '+app.getTimeInMinSec(app.time), 10, 50);
      } 

      function mouseClicked(){    
        app.sketchs[app.counter].mouseClicked(mouseX,mouseY);  
      }    
      console.log('Exe end'); 
    </script>
  </body>
</html>

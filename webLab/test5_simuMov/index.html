<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Web test">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" > 
    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.4.0/dist/css/uikit.min.css" />    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <title>Web Test5_simuMov</title>
    <style> 
      #loading{
        background-color: rgb(255,255,255,0.85);
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 100000;
        display: flex;
        align-items: center;
        justify-content: center; 
        opacity: 0.75;
      }  
    </style>
  </head>
  <body>   
    <div id="loading"> 
      <div uk-spinner="ratio: 5"></div>
    </div> 
    <div id="app">
      <div class="uk-grid-collapse uk-grid-match  uk-child-width-expand@s uk-padding-small" uk-grid>
        <div class="uk-width-1-4@m">
          <div class="uk-placeholder">  
            <div class="uk-margin">              
              <button id="btn1" class="uk-button uk-width-1-1 uk-button-primary"><span uk-icon="icon: play-circle"></span></button>
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="form-stacked-text">NÂº point</label>
              <div class="uk-form-controls">
                <select id="sel1" class="uk-select uk-form-small"></select>
              </div>
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="form-stacked-text">Speed</label>
              <div class="uk-form-controls">
                <select id="sel2" class="uk-select uk-form-small"></select>
              </div>
            </div>
            <div class="uk-margin">
              <label class="uk-form-label" for="form-stacked-text">Mobility</label>
              <div class="uk-form-controls">
                <select id="sel3" class="uk-select uk-form-small"></select>
              </div>
            </div>
          </div>
        </div>
        <div class="uk-width-expand@m">
            <div class="uk-placeholder">              
              <div class="uk-margin">
                <canvas id="chart"></canvas>
              </div>
              <div class="uk-margin">
                <canvas id="canvas"></canvas>
              </div>
            </div>
        </div>
      </div>
    </div> 
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.4.0/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.4.0/dist/js/uikit-icons.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/3.6.2/fabric.min.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/6.6.2/math.min.js"></script>  
    <script type="text/javascript"> 
      (function exe(){   
        var simu = {
          interval: undefined, 
          states:[
            [0],
            [0],
            [10]
          ],
          start: function(){ 
            var chart = new Chart('chart',{
              type: 'line',
              data: {
                labels: [],
                datasets: [{
                  data: this.states[0],
                  borderColor: 'red',
					        backgroundColor: 'red',
                  fill: 'origin',  
                  label: 'state 1'
                } ,{
                  data: this.states[1],
                  borderColor: 'green',
					        backgroundColor: 'green', 
                  fill: 0,  
                  label: 'state 2'
                },{
                  data: this.states[2],
                  borderColor: 'blue',
					        backgroundColor: 'blue', 
                  fill: 1,  
                  label: 'state 3'
                }]
              },
              options: {
                responsive: true,
                title: {
                  display: false
                },
                tooltips: {
                  mode: 'index',
                  intersect: false,
                },
                hover: {
                  mode: 'nearest',
                  intersect: true
                },
                scales: {
                  xAxes: [{
                    display: true,
                    scaleLabel: {
                      display: true,
                      labelString: 'Time'
                    }
                  }],
                  yAxes: [{
                    display: true,
                    scaleLabel: {
                      display: true,
                      labelString: 'N'
                    }
                  }]
                }
              }
            });
            var pos = 1; 
                       
            this.interval = setInterval(function(){ 
              chart.data.labels.push(pos); 
              pos++;
              
              var give = 0;
              var get = 0; 
              var caseState = [
                [0,1],
                [0,2], 
                [1,0],
                [1,2],
                [2,0],
                [2,0],
              ];
              var exit = false;
              var randState = 0;
              while (!exit) {
                randState =  Math.floor((Math.random()*6)+1)-1;
                if (chart.data.datasets[caseState[randState][0]].data[chart.data.datasets[caseState[randState][0]].data.length-1]>0){
                  exit = true;
                }
              }  
              for (var i=0; i<chart.data.datasets.length; i++){
                if(i===caseState[randState][0]){
                  chart.data.datasets[i].data.push(chart.data.datasets[i].data[chart.data.datasets[i].data.length-1]-1);
                }else if(i===caseState[randState][1]){
                  chart.data.datasets[i].data.push(chart.data.datasets[i].data[chart.data.datasets[i].data.length-1]+1);
                }else{
                  chart.data.datasets[i].data.push(chart.data.datasets[i].data[chart.data.datasets[i].data.length-1]);
                } 
              }      
              chart.update();
              if(pos>25){
                simu.stop();
              }
            },250);   
                      
          },
          stop: function(){
            clearInterval(this.interval);
          }
        }
        var dApp = {
          onOffLoading: function(state){ 
            if(state){
              $('#loading').css({
                display: 'flex'
              });
            }else{
              $('#loading').css({
                display: 'none'
              });
            } 
          },
          resize: function(){   
            dApp.onOffLoading(true); 
            $('#app').innerHeight($(window).innerHeight());           
            dApp.onOffLoading(false);  
          },
          exe: function(){
            $('#sel1').append('<option value="10">10</option>');
            $('#sel1').append('<option value="50">50</option>');        
            $('#sel1').append('<option value="100">100</option>');
            $('#sel2').append('<option value="10">10</option>');
            $('#sel2').append('<option value="25">25</option>');
            $('#sel2').append('<option value="50">50</option>');
            $('#sel3').append('<option value="10">10</option>');
            $('#sel3').append('<option value="100">100</option>');
            $('#sel3').append('<option value="1000">1000</option>');
            $('#btn1').on('click',function(){
              if($('#btn1').hasClass('uk-button-primary')){
                $('#btn1').html('<span uk-icon="icon: ban"></span>');
                $('#btn1').removeClass('uk-button-primary');
                $('#btn1').addClass('uk-button-danger');
                $('select').attr('disabled',true);
                simu.start();
              }else{ 
                $('#btn1').html('<span uk-icon="icon: play-circle"></span>');
                $('#btn1').removeClass('uk-button-danger');
                $('#btn1').addClass('uk-button-primary');
                $('select').removeAttr('disabled');
                simu.stop();
              }
            });
            this.resize();
            $(window).on('click',this.resize);
            $('#btn1').trigger('click'); 
          }
        }
        dApp.exe();
      })();
    </script>
    <noscript>JAVASCRIPT NOT WORKING!</noscript>
  </body>
</html>

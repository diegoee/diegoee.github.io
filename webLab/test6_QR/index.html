<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"> 
    <title>Web Test6_QR</title> 
    <style>   
      html,body{ 
        padding: 0;
        margin: 0;
        background-color: #333; 
        color: #DDD;
        -webkit-user-select: none;  
        -khtml-user-select: none;  
          -moz-user-select: none;  
            -ms-user-select: none;  
                user-select: none; 
        -webkit-tap-highlight-color: transparent; 
      }  
       
      #menu{     
        font-size: 2em;
        padding: 1em;
        text-align: center;  
      }
      #menu p{     
        padding: 0;
        margin: 0;  
      }

      #textExe{    
        font-size: 0.75em; 
        width: 50%;
      }
      @media (max-width: 680px) {
        #textExe{     
          width: 95%;
        }
      }

      #downloadImg{ 
        color: #DDD;
        transition: 0.25s;
      }
      #downloadImg:active{ 
        color: #444;
      }
      #downloadImg:hover{ 
        text-shadow: 0 0 10px #DDD;
      } 

      #qrcode-container{  
        display: flex;
        align-items: center;
        justify-content: center; 
      }  
    </style>  
  </head>
  <body>   
    <div id="body"> 
      <div id="menu">
        <div><p>Text to QR</p></div> 
        <div><input type="text"   id="textExe" value="Hola Mundo"></div>
        <div><a id="downloadImg" href="#" download="myQr.jpg"> Download QR</a></div>  
      </div>
    </div>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>  
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script type="text/javascript">  
      var app = {  
        exe: function(){ 
          $('#qrcode-container').remove(); 
          $('#body').append('<div id="qrcode-container"><canvas id="qrcode"></canvas><div>'); 
          var dim = ($(window).innerHeight()-$('#menu').innerHeight()>$(window).innerWidth()?$(window).innerWidth()-10:$(window).innerHeight()-$('#menu').innerHeight()-10);
          try{
            var text = $('#textExe').val().trim(); 
            var qrcode = new QRious({
              element: document.getElementById('qrcode'), 
              level: 'H', 
              size: dim, 
              value: text
            }); 
            $('#downloadImg').attr('download','myQr_'+text.replaceAll(/ /ig,'_')+'.jpg'); 
            $('#downloadImg').attr('href',document.getElementById('qrcode').toDataURL());
          }catch(e){
            console.error(e);
            $('#qrcode-container').html('<p>Error in <b>qriousjs</b>. '+e+'</p>');  
          }
        },
        init: function(){
          console.log('app exe start');   
          $('#textExe').on('input',function(){
            app.exe();
          }); 
          app.exe();
          $(window).on('resize',app.exe);           
          console.log('app exe end');
        }     
      };  
      app.init();   
    </script> 
  </body>
</html>
